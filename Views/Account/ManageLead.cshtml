@model List<CRM_Buddies_Task.Models.LeadColumnModel>

@{
    ViewBag.Title = "Manage Lead Table";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid pt-4 theme-sensitive-text fade-in">

    <!-- HEADER -->
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <div class="page-header shadow-sm">
                <h2 class="mb-2">
                    <i class="bi bi-table me-2"></i> Manage Lead Table
                </h2>
                <p class="mb-0">
                    Configure and manage dynamic lead table columns
                </p>
            </div>
        </div>

        <div class="col-md-4 text-md-end mt-3 mt-md-0">
            <a href="@Url.Action("ManageLeadApplications", "Account")"
               class="btn btn-outline-info primary-action-btn">
                <i class="bi bi-kanban me-1"></i> Lead Applications
            </a>
        </div>
    </div>

    <!-- EXISTING COLUMNS -->
    <div class="card dashboard-card shadow-sm border-0 mb-4 fade-in">
        <div class="card-header">
            <strong>
                <i class="bi bi-columns-gap me-1"></i> Existing Columns
            </strong>
        </div>

        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="custom-table table-hover align-middle mb-0">
                    <thead class="table-primary">
                        <tr>
                            <th>Column Name</th>
                            <th>Data Type</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var col in Model)
                            {
                                <tr>
                                    <td>@col.ColumnName</td>
                                    <td>@col.DataType</td>
                                    <td class="text-center">
                                        <form action="@Url.Action("DeleteColumn", "Account")"
                                              method="post"
                                              class="d-inline"
                                              onsubmit="return confirm('Are you sure you want to delete this column?');">

                                            <input type="hidden" name="columnName" value="@col.ColumnName" />

                                            <button type="submit"
                                                    class="btn btn-sm btn-outline-danger primary-action-btn">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">
                                    No columns found.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ADD NEW COLUMN -->
    <div class="card dashboard-card shadow-sm border-0 fade-in">
        <div class="card-header bg-success text-white">
            <strong>
                <i class="bi bi-plus-square me-1"></i> Add New Column
            </strong>
        </div>

        <div class="card-body">
            <form action="@Url.Action("AddColumn", "Account")"
                  method="post"
                  class="row g-3">

                <div class="col-md-5">
                    <label class="form-label fw-semibold">Column Name</label>
                    <input name="columnName"
                           class="form-control"
                           placeholder="Enter column name"
                           required />
                </div>

                <div class="col-md-5">
                    <label class="form-label fw-semibold">Data Type</label>
                    <select name="dataType" class="form-select" required>
                        <option value="">-- Select Data Type --</option>
                        <option value="NVARCHAR(100)">Text</option>
                        <option value="INT">Integer</option>
                        <option value="BIGINT">Big Number</option>
                        <option value="DECIMAL(18,2)">Decimal</option>
                        <option value="FLOAT">Floating Point</option>
                        <option value="DATE">Date</option>
                        <option value="DATETIME">Date & Time</option>
                        <option value="TEXT">Description</option>
                        <option value="UNIQUEIDENTIFIER">GUID</option>
                        <option value="VARCHAR(15)">Mobile Number</option>
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit"
                            class="btn btn-success w-100 primary-action-btn">
                        <i class="bi bi-plus-circle me-1"></i> Add
                    </button>
                </div>
            </form>
        </div>
    </div>

</div>

<!-- TOAST MESSAGE -->
@{
    var success = TempData["SuccessMessage"] ?? "";
    var error = TempData["ErrorMessage"] ?? "";
}

<script>
    (function () {
        var success = @Html.Raw(Json.Encode(success));
        var error = @Html.Raw(Json.Encode(error));

        function showToast(msg, bg) {
            if (!msg) return;

            const toast = document.createElement('div');
            toast.innerText = msg;
            toast.style.position = 'fixed';
            toast.style.top = '20px';
            toast.style.right = '20px';
            toast.style.background = bg;
            toast.style.color = '#fff';
            toast.style.padding = '10px 16px';
            toast.style.borderRadius = '6px';
            toast.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
            toast.style.zIndex = 9999;
            toast.style.fontSize = '13px';

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 400);
            }, 2500);
        }

        if (success) showToast(success, '#28a745');
        else if (error) showToast(error, '#dc3545');
    })();
</script>
