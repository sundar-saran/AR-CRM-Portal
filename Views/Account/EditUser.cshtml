@model CRM_Buddies_Task.Models.UserDetailsViewModel

@{
    ViewBag.Title = "Edit User";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <style>
        .fade-in {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.6s ease forwards;
            animation-delay: 0.15s;
        }
        @@keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-control {
            border-radius: 0.5rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-control:focus {
            border-color: #4ca1af;
            box-shadow: 0 0 8px rgba(76, 161, 175, 0.5);
        }

        .text-danger {
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .btn + .btn {
            margin-left: 0.75rem;
        }

        input[readonly] {
            background-color: #e9ecef;
        }
        body.dark-theme input[readonly] {
            background-color: #3a3a3a;
            color: #eee;
        }
    </style>
}

<div class="container fade-in mt-4 pt-5" style="max-width: 600px;">
    <h3 class="mb-3 theme-sensitive-text">
        <i class="bi bi-pencil-square me-2"></i>Edit User
    </h3>
    <hr />

    @using (Html.BeginForm("EditUser", "Account", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.UserId)

        <div class="mb-3">
            @Html.LabelFor(m => m.FullName, htmlAttributes: new { @class = "form-label fw-semibold theme-sensitive-text" })
            @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", required = "required" })
            @Html.ValidationMessageFor(m => m.FullName, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            @Html.LabelFor(m => m.Mobile, htmlAttributes: new { @class = "form-label fw-semibold theme-sensitive-text" })
            @Html.TextBoxFor(m => m.Mobile, new { @class = "form-control", required = "required" })
            @Html.ValidationMessageFor(m => m.Mobile, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            @Html.LabelFor(m => m.City, htmlAttributes: new { @class = "form-label fw-semibold theme-sensitive-text" })
            @Html.TextBoxFor(m => m.City, new { @class = "form-control", required = "required" })
            @Html.ValidationMessageFor(m => m.City, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            @Html.LabelFor(m => m.Email, htmlAttributes: new { @class = "form-label fw-semibold theme-sensitive-text" })
            @Html.TextBoxFor(m => m.Email, new { @class = "form-control", @readonly = "readonly" })
        </div>

        <div class="mb-4 form-check">
            @Html.CheckBoxFor(m => m.IsActive, new { @class = "form-check-input", id = "IsActive" })
            @Html.LabelFor(m => m.IsActive, "Active", new { @class = "form-check-label theme-sensitive-text" })
        </div>

        <div class="d-flex justify-content-start">
            <button type="submit" class="btn btn-success shadow-sm">
                <i class="bi bi-check-lg me-1"></i> Save
            </button>
            <a href="@Url.Action("UserList", "Account")" class="btn-back">
                <i class="bi bi-arrow-left-circle me-1"></i> Back
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
    (function() {
        var success = @Html.Raw(Json.Encode(TempData["SuccessMessage"] ?? ""));
        var error = @Html.Raw(Json.Encode(TempData["ErrorMessage"] ?? ""));

        function showPopup(msg, bgColor) {
            if (!msg) return;
            var popup = document.createElement('div');
            popup.textContent = msg;
            popup.style.position = 'fixed';
            popup.style.top = '20px';
            popup.style.right = '20px';
            popup.style.background = bgColor || '#4CAF50';
            popup.style.color = '#fff';
            popup.style.padding = '10px 14px';
            popup.style.borderRadius = '6px';
            popup.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)';
            popup.style.zIndex = 99999;
            popup.style.fontSize = '13px';
            document.body.appendChild(popup);

            setTimeout(function() {
                popup.style.transition = "opacity 0.5s";
                popup.style.opacity = 0;
                setTimeout(function() { popup.remove(); }, 500);
            }, 2000);
        }

        if (success) showPopup(success, '#4CAF50');
        else if (error) showPopup(error, '#E53935');
    })();
    </script>
}
